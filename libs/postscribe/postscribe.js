!function(){function a(){}var i={afterAsync:a,afterDequeue:a,afterStreamStart:a,afterWrite:a,autoFix:!0,beforeEnqueue:a,beforeWriteToken:function(t){return t},beforeWrite:function(t){return t},done:a,error:function(t){throw t},releaseAsync:!1},o=this,e=void 0;function s(t){return t!==e&&null!==t}if(!o.postscribe){var c,u,p,h,t=Array.prototype.slice,l=(c="data-ps-",r.prototype.write=function(){var t;for([].push.apply(this.writeQueue,arguments);!this.deferredRemote&&this.writeQueue.length;)f(t=this.writeQueue.shift())?this.callFunction(t):this.writeImpl(t)},r.prototype.callFunction=function(t){var e={type:"function",value:t.name||t.toString()};this.onScriptStart(e),t.call(this.win,this.doc),this.onScriptDone(e)},r.prototype.writeImpl=function(t){this.parser.append(t);for(var e,r,n,i,o,s=[];(e=this.parser.readToken())&&!(r=!!((o=e)&&"tagName"in o)&&!!~o.tagName.toLowerCase().indexOf("script"))&&!(n=!!((i=e)&&"tagName"in i)&&!!~i.tagName.toLowerCase().indexOf("style"));)(e=this.options.beforeWriteToken(e))&&s.push(e);this.writeStaticTokens(s),r&&this.handleScriptToken(e),n&&this.handleStyleToken(e)},r.prototype.writeStaticTokens=function(t){var e=this.buildChunk(t);if(e.actual)return e.html=this.proxyHistory+e.actual,this.proxyHistory+=e.proxy,this.proxyRoot.innerHTML=e.html,this.walkChunk(),e},r.prototype.buildChunk=function(t){var n=this.actuals.length,i=[],o=[],s=[];return d(t,function(t){var e=htmlParser.tokenToString(t);if(i.push(e),t.attrs){if(!/^noscript$/i.test(t.tagName)){var r=n++;o.push(e.replace(/(\/?>)/," "+c+"id="+r+" $1")),"ps-script"!==t.attrs.id&&"ps-style"!==t.attrs.id&&s.push("atomicTag"===t.type?"":"<"+t.tagName+" "+c+"proxyof="+r+(t.unary?" />":">"))}}else o.push(e),s.push("endTag"===t.type?e:"")}),{tokens:t,raw:i.join(""),actual:o.join(""),proxy:s.join("")}},r.prototype.walkChunk=function(){for(var t,e=[this.proxyRoot];s(t=e.shift());){var r=1===t.nodeType;if(!r||!S(t,"proxyof")){r&&S(this.actuals[S(t,"id")]=t,"id",null);var n=t.parentNode&&S(t.parentNode,"proxyof");n&&this.actuals[n].appendChild(t)}e.unshift.apply(e,w(t.childNodes))}},r.prototype.handleScriptToken=function(t){var e=this.parser.clear();if(e&&this.writeQueue.unshift(e),t.src=t.attrs.src||t.attrs.SRC,t=this.options.beforeWriteToken(t)){t.src&&this.scriptStack.length?this.deferredRemote=t:this.onScriptStart(t);var r=this;this.writeScriptToken(t,function(){r.onScriptDone(t)})}},r.prototype.handleStyleToken=function(t){var e=this.parser.clear();e&&this.writeQueue.unshift(e),t.type=t.attrs.type||t.attrs.TYPE||"text/css",(t=this.options.beforeWriteToken(t))&&this.writeStyleToken(t),e&&this.write()},r.prototype.writeStyleToken=function(t){var e=this.buildStyle(t);this.insertStyle(e),t.content&&(e.styleSheet&&!e.sheet?e.styleSheet.cssText=t.content:e.appendChild(this.doc.createTextNode(t.content)))},r.prototype.buildStyle=function(t){var r=this.doc.createElement(t.tagName);return r.setAttribute("type",t.type),y(t.attrs,function(t,e){r.setAttribute(t,e)}),r},r.prototype.insertStyle=function(t){this.writeImpl('<span id="ps-style"/>');var e=this.doc.getElementById("ps-style");e.parentNode.replaceChild(t,e)},r.prototype.onScriptStart=function(t){t.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(t)},r.prototype.onScriptDone=function(t){t===this.scriptStack[0]?(this.scriptStack.shift(),this.write.apply(this,t.outerWrites),!this.scriptStack.length&&this.deferredRemote&&(this.onScriptStart(this.deferredRemote),this.deferredRemote=null)):this.options.error({message:"Bad script nesting or script finished twice"})},r.prototype.writeScriptToken=function(t,e){var r=this.buildScript(t),n=this.shouldRelease(r),i=this.options.afterAsync;t.src&&(r.src=t.src,this.scriptLoadHandler(r,n?i:function(){e(),i()}));try{this.insertScript(r),t.src&&!n||e()}catch(t){this.options.error(t),e()}},r.prototype.buildScript=function(t){var r=this.doc.createElement(t.tagName);return y(t.attrs,function(t,e){r.setAttribute(t,e)}),t.content&&(r.text=t.content),r},r.prototype.insertScript=function(t){this.writeImpl('<span id="ps-script"/>');var e=this.doc.getElementById("ps-script");e.parentNode.replaceChild(t,e)},r.prototype.scriptLoadHandler=function(t,e){function r(){t=t.onload=t.onreadystatechange=t.onerror=null}var n=this.options.error;function i(){r(),e()}m(t,{onload:function(){i()},onreadystatechange:function(){/^(loaded|complete)$/.test(t.readyState)&&i()},onerror:function(){!function(t){r(),n(t),e()}({message:"remote script failed "+t.src})}})},r.prototype.shouldRelease=function(t){return!/^script$/i.test(t.nodeName)||!!(this.options.releaseAsync&&t.src&&t.hasAttribute("async"))},r);o.postscribe=(u=0,h=null,m(g,{streams:{},queue:p=[],WriteStream:l}))}function f(t){return"function"==typeof t}function d(t,e,r){var n,i=t&&t.length||0;for(n=0;n<i;n++)e.call(r,t[n],n)}function y(t,e,r){var n;for(n in t)t.hasOwnProperty(n)&&e.call(r,n,t[n])}function m(r,t){return y(t,function(t,e){r[t]=e}),r}function w(e){try{return t.call(e)}catch(t){var r=[];return d(e,function(t){r.push(t)}),r}}function S(t,e,r){var n=c+e;if(2===arguments.length){var i=t.getAttribute(n);return s(i)?String(i):i}s(r)&&""!==r?t.setAttribute(n,r):t.removeAttribute(n)}function r(t,e){var r=t.ownerDocument;m(this,{root:t,options:e,win:r.defaultView||r.parentWindow,doc:r,parser:htmlParser("",{autoFix:e.autoFix}),actuals:[t],proxyHistory:"",proxyRoot:r.createElement(t.nodeName),scriptStack:[],writeQueue:[]}),S(this.proxyRoot,"proxyof",0)}function v(){var t,e=p.shift();e&&((t=function(t){return t[t.length-1]}(e)).afterDequeue(),e.stream=function(t,e,n){(h=new l(t,n)).id=u++,h.name=n.name||h.id,g.streams[h.name]=h;var r=t.ownerDocument,i={close:r.close,open:r.open,write:r.write,writeln:r.writeln};function o(t){t=n.beforeWrite(t),h.write(t),n.afterWrite(t)}m(r,{close:a,open:a,write:function(){return o(w(arguments).join(""))},writeln:function(){return o(w(arguments).join("")+"\n")}});var s=h.win.onerror||a;return h.win.onerror=function(t,e,r){n.error({msg:t+" - "+e+":"+r}),s.apply(h.win,arguments)},h.write(e,function(){m(r,i),h.win.onerror=s,n.done(),h=null,v()}),h}.apply(null,e),t.afterStreamStart())}function g(t,e,r){f(r)&&(r={done:r}),r=function(r,t){return r=r||{},y(t,function(t,e){s(r[t])||(r[t]=e)}),r}(r,i);var n=[t=/^#/.test(t)?o.document.getElementById(t.substr(1)):t.jquery?t[0]:t,e,r];return t.postscribe={cancel:function(){n.stream?n.stream.abort():n[1]=a}},r.beforeEnqueue(n),p.push(n),h||v(),t.postscribe}}();